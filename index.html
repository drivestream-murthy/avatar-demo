<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Avatar Gen — ERP (Portrait) RAG</title>
    <link rel="preconnect" href="https://www.youtube.com">
    <link rel="preconnect" href="https://www.google.com">
    <link rel="preconnect" href="https://i.ytimg.com">
    <link rel="preconnect" href="https://s.ytimg.com">
    <link rel="preconnect" href="https://share.synthesia.io">
    <link rel="preconnect" href="https://stream.mux.com">
    <link rel="preconnect" href="https://manifest-gcp-us-east1-vop1.fastly.mux.com">
    <link rel="preconnect" href="https://www.drivestream.com">
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
      :root { --w: 420px; --radius: 16px; }
      * { box-sizing: border-box; }
      body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; display:flex; justify-content:center; padding:16px; background:#0f1115; color:#eaeef5; }
      #app { width:min(100%, var(--w)); }
      header { margin-bottom:10px; }
      h1 { font-size:18px; margin:0 0 4px; }
      .muted { opacity:.75; margin:0; font-size:12px; }
      #banner { position:fixed; top:0; left:0; right:0; padding:10px 14px; background:#2b132a; color:#ffd3e6; border-bottom:1px solid #6a2a67; font-size:14px; z-index:9999; display:none; }
      #banner.show { display:block; }
      #micChip { position:fixed; left:12px; bottom:12px; z-index:10000; padding:8px 10px; border-radius:999px; background:#151a28; border:1px solid #2a2f3a; font-size:12px; }
      #micChip .dot { display:inline-block; width:8px; height:8px; border-radius:999px; margin-right:6px; background:#d33; }
      #micChip.listening .dot { background:#0f0; }
      #stage { width:100%; aspect-ratio:9/16; position:relative; overflow:hidden; border-radius:var(--radius); background:#1b1f2a center/cover no-repeat; box-shadow:0 8px 30px rgba(0,0,0,.35); }
      #avatarVideo, #avatarCanvas { position:absolute; inset:0; z-index:1; transition:transform .25s ease; }
      #avatarVideo { opacity:0; }
      #stage.min #avatarCanvas, #stage.min #avatarVideo { transform: translateY(12%) scale(.86); transform-origin: center bottom; }
      #logo{ position:absolute; right:10px; top:10px; z-index:6; height:40px; width:auto; pointer-events:none; object-fit:contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); }
      #stageOverlay { position:absolute; left:3%; right:3%; top:3%; aspect-ratio:16/9; border-radius:12px; overflow:hidden; background:#000; box-shadow:0 6px 18px rgba(0,0,0,.35); display:none; z-index:2; }
      #overlayBar { position:absolute; right:6px; top:6px; z-index:3; display:flex; gap:6px; }
      #overlayBar button { padding:6px 10px; border:1px solid #2a2f3a; background:#151a28; color:#eaeef5; border-radius:8px; cursor:pointer; }
      #ytContainer, #overlayFrame { width:100%; height:100%; border:0; display:none; }
      .show { display:block !important; }
      #spinner { position:absolute; inset:0; display:none; align-items:center; justify-content:center; color:#eaeef5; background:linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.35)); z-index:2; font-size:14px; }
      #spinner::before { content:""; width:20px; height:20px; margin-right:10px; border-radius:50%; border:3px solid rgba(255,255,255,.25); border-top-color:#fff; animation:spin 0.8s linear infinite; }
      @keyframes spin { to { transform:rotate(360deg); } }
      #sessionFab{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index: 5; width: 120px; height: 120px; border-radius: 999px; border: 2px solid #2a2f3a; background:#0f1320; color:#eaeef5; font-size:18px; font-weight:600; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,.35); }
      #stage.min #sessionFab { transform: translate(-50%,-50%) scale(.86); }
      #resetBtn{ position:absolute; left:10px; top:10px; z-index:6; padding:8px 10px; border-radius:10px; border:1px solid #2a2f3a; background:#0f1320; color:#eaeef5; cursor:pointer; font-size:12px; }
      .card { margin-top:10px; background:#0f1320; border:1px solid #2a2f3a; padding:10px; border-radius:12px; }
      .hidden { display:none !important; }
      .card p { margin:0 0 8px; font-size:13px; opacity:.85; }
      .card button { display:block; width:100%; text-align:left; margin:6px 0; padding:10px; border-radius:10px; border:1px solid #2a2f3a; background:#151a28; color:#eaeef5; cursor:pointer; }
      .card button:hover { background:#1c2336; }
      form { display:flex; gap:8px; margin-top:10px; }
      input { flex:1; padding:10px; border:1px solid #2a2f3a; border-radius:10px; background:#0f1320; color:#eaeef5; }
      button { padding:10px 12px; border-radius:10px; border:1px solid #2a2f3a; background:#151a28; color:#eaeef5; cursor:pointer; }
      button:hover { background:#1c2336; }
    </style>
  </head>
  <body>
    <div id="banner"></div>
    <div id="micChip"><span class="dot"></span><span id="micLabel">voice off</span></div>
    <div id="app">
      <header>
        <h1>Avatar Gen — ERP (Portrait) RAG</h1>
        <p class="muted">Greets once → name & university → auto background → Drivestream topics or ERP → summary → consent → in-frame video → auto-continue. Now with live page Q&A.</p>
      </header>
      <div id="stage">
        <video id="avatarVideo" playsinline autoplay muted></video>
        <canvas id="avatarCanvas"></canvas>
        <img id="logo" src="/assets/Drivestream_LARGE.jpg" alt="Drivestream" />
        <button id="sessionFab" aria-live="polite">▶ Start</button>
        <button id="resetBtn" title="Reset session">↺ Reset</button>
        <div id="stageOverlay">
          <div id="overlayBar">
            <button id="overlayToggle" style="display:none">⏸ Pause</button>
            <button id="closeOverlay">Close</button>
          </div>
          <div id="spinner">Loading…</div>
          <div id="ytContainer"></div>
          <iframe id="overlayFrame" allow="autoplay; encrypted-media; picture-in-picture; fullscreen" referrerpolicy="origin-when-cross-origin"></iframe>
        </div>
      </div>
      <div id="confirmBar" class="card hidden">
        <p>Would you like to watch the video now?</p>
        <div style="display:flex; gap:8px;">
          <button id="confirmYes">Yes, play video</button>
          <button id="confirmNo">No, continue</button>
        </div>
      </div>
      <div id="menuERP" class="card hidden">
        <p>ERP training options:</p>
        <button id="opt1">ERP Module 1 — Finance & Accounting</button>
        <button id="opt2">ERP Module 2 — Human Resources (HR)</button>
      </div>
      <div id="menuDS" class="card hidden">
        <p>Drivestream topics:</p>
        <button data-ds="about">About Drivestream</button>
        <button data-ds="partners">Partners</button>
        <button data-ds="subscription">Oracle Cloud Services Subscription</button>
        <button data-ds="consulting">Oracle Cloud Consulting</button>
        <button data-ds="erp">Oracle Cloud ERP</button>
        <button data-ds="hcm">Oracle Cloud HCM</button>
        <button data-ds="payroll">Oracle Cloud HCM Payroll</button>
        <button data-ds="advisory">Strategy & Advisory</button>
        <button data-ds="ams">AMS (Managed Services)</button>
        <button data-ds="industries">Industries</button>
        <button data-ds="finserv">Financial Services</button>
        <button data-ds="profserv">Professional Services</button>
        <button data-ds="retail">Retail</button>
        <button data-ds="hightech">High Tech</button>
        <button data-ds="utilities">Utilities</button>
        <button data-ds="healthcare">Healthcare</button>
        <button data-ds="manufacturing">Manufacturing</button>
        <button data-ds="customers">Customers</button>
        <button data-ds="team">Meet the Team</button>
      </div>
      <form id="ask">
        <input id="text" placeholder='Say or type: “I’m Alex from Stanford University”, “ERP Module 1”, “both modules”, “CEO?”, or any Drivestream topic…' />
        <button type="submit">Send</button>
      </form>
    </div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>